---
layout: post
title: win服务器超出最大允许连接数
date: 2017-04-14
categories: blog
tags: [windows]
description: win服务器超出最大允许连接数
---

常遇到这种情况，说服务器连接不上，提示“终端服务器超出了最大允许连接数”。下面说说产生这个问题的原因以及解决办法。

### 一、出现这个问题的原因

引起该问题的原因在于终端服务的**缺省链接数为2个链接**，并且当登录远程桌面后如果不是采用**注销方式退出**，而是直接关闭远程桌面窗口，那么实际上会话并没有释放掉，而是继续保留在服务器端，这样就会占用总的链接数，当这个数量达到最大允许值时就会出现上面的提示。

### 二、这个问题的解决办法

当出现这个问题的时候，解决方法要与您本地使用的操作系统有关系。

1. 如果您本地使用的是 Windows XP、Windows 2008、Windows 7/8/8.1操作系统，那么在远程的时候在IP 后面添加参数 `/admin` 远程即可。

2. 如果您本地使用的是 windows 2003 系统，那么您远程的时候，添加 `/console` 远程即可，然后就可以进入服务器了。

![](https://azraelgreen.github.io/img/20170414_win_remote_links.png)

### 三、说明一下添加参数的作用以及原理。

无论是添加 `/admin` 还是添加 `/console` 来进行远程，都是连接到远程服务器的显示器操作界面，即服务器的**本地控制终端**。相当于linux的tty终端口。windows另外的那两个远程端口是**远程终端**，就是这么的一个原理。

### 四、从根本上解决需要修改服务器端配置:

1. 用注销来退出远程桌面而不是直接关闭窗口
2. 限制已断开链接的会话存在时间
3. 增加最多链接数，即设置可连接的数量多些

下面说明一下，增加最多链接数，修改方法：

#### 1.从终端服务配置中修改：

打开管理工具里的终端服务配置，再单击连接，双击右边的 RDP-Tcp，弹出 RDP-Tcp 属性，选择 网卡，可设置最多连接数，或者设置为无限制的连接数。

当然这个值不也能太大，否则会占用较多的系统资源。不过这里修改的值好像不起作用，设置成无限制时照样还是会出现本文所说的情况。

修改会话存在时间：

运行－Tscc.msc－连接－双击RDP-Tcp或右击－属性－会话－选中第一个的替代用户设置(O)－结束已断开的会话［将默认值“从不”改为一个适当的时间，比如30分钟］

#### 2.打开“控制面板”，

双击“添加删除程序”，单击“添加删除Windows组件”，“组件”，在Windows组件向导对话框中选中“终端服务” ， “下一步” ， “应用服务器” ， “下一步”，然后按照提示即可改变终端服务的模式。 不过听说用此法，改了应用需要许可证，90天后过期:(

#### 3.win2003的话可以从组策略修改：

组策略级别要高于终端服务配置，当启用组策略后终端服务配置中的相应选项会变成灰色不可修改

运行－gpedit.msc－计算机配置－管理模板－Windows组件－终端服务

双击右边的”限制连接数量“－选择”已启用“－填入允许的最大连接数